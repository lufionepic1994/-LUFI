<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat AI</title>

<style>
* { box-sizing: border-box; }

body {
    margin: 0;
    font-family: sans-serif;
    direction: rtl;
    height: 100vh;
    display: flex;
    flex-direction: column;
    color: white;

    /* Ø¨Ú© Ú¯Ø±Ø§Ù†Ø¯ Ø²ÙˆØ±Ùˆ */
    background: url("Zoro.jpeg") no-repeat center center fixed;
    background-size: cover;
}

/* Ù„Ø§ÛŒÙ‡ ØªÛŒØ±Ù‡ */
body::before {
    content: "";
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.55);
    z-index: -1;
}

/* Ø­Ø§Ù„Øª Ø±ÙˆØ² */
body.light::before {
    background: rgba(255,255,255,0.6);
}

header {
    padding: 1rem;
    text-align: center;
    background: rgba(32,33,35,0.9);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

header button {
    font-size: .85rem;
    padding: .3rem .6rem;
}

#chat {
    flex: 1;
    overflow-y: auto;
    padding: 1rem;
    scroll-behavior: smooth;
}

.msg {
    max-width: 85%;
    padding: .9rem 1rem;
    margin: .6rem 0;
    border-radius: .8rem;
    line-height: 1.7;
    white-space: pre-wrap;
    word-wrap: break-word;
    overflow-wrap: break-word;
    animation: fade .25s ease;
}

@keyframes fade {
    from {opacity:0; transform:translateY(8px);}
    to {opacity:1; transform:translateY(0);}
}

.user {
    background: #0b93f6;
    margin-left: auto;
    border-bottom-right-radius: 0;
}

.bot {
    background: #444654;
    margin-right: auto;
    border-bottom-left-radius: 0;
}

body.light .bot {
    background:#e5e7eb;
    color:#000;
}

body.light .user {
    background:#2563eb;
}

footer {
    background: rgba(32,33,35,0.95);
    padding: .7rem;
    display: flex;
    gap: .6rem;
}

textarea {
    flex: 1;
    resize: none;
    border-radius: .6rem;
    border: none;
    padding: .7rem;
    font-size: 1rem;
    min-height: 3rem;
    max-height: 150px;
    overflow-y: auto;
    outline: none;
}

button {
    border: none;
    border-radius: .6rem;
    background: #0b93f6;
    color: white;
    padding: 0 1rem;
    cursor: pointer;
}

button:disabled {
    opacity: .5;
    cursor: not-allowed;
}
</style>
</head>

<body>

<header>
    <span>ðŸ¤– Ú†Øª Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</span>
    <div>
        <button onclick="toggleTheme()">ðŸŒ“</button>
        <button onclick="clearChat()">ðŸ—‘</button>
    </div>
</header>

<div id="chat"></div>

<footer>
    <textarea id="q" placeholder="Ù¾ÛŒØ§Ù…... (Enter=Ø§Ø±Ø³Ø§Ù„ | Shift+Enter=Ø®Ø· Ø¬Ø¯ÛŒØ¯)"></textarea>
    <button id="sendBtn" onclick="send()">Ø§Ø±Ø³Ø§Ù„</button>
</footer>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("q");
const btn = document.getElementById("sendBtn");

/* Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú†Øª */
chat.innerHTML = localStorage.getItem("chat") || "";

/* Ø§Ø¶Ø§ÙÙ‡ Ù¾ÛŒØ§Ù… */
function addMessage(text, cls) {
    const div = document.createElement("div");
    div.className = "msg " + cls;
    div.innerText = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
    saveChat();
    return div;
}

/* ØªØ§ÛŒÙ¾ ØªØ¯Ø±ÛŒØ¬ÛŒ */
function typeText(el, text) {
    el.innerText = "";
    let i = 0;
    const t = setInterval(() => {
        el.innerText += text[i++];
        chat.scrollTop = chat.scrollHeight;
        if (i >= text.length) {
            clearInterval(t);
            btn.disabled = false;
            saveChat();
        }
    }, 20);
}

/* Ø§Ø±Ø³Ø§Ù„ */
function send() {
    const text = input.value.trim();
    if (!text) return;

    addMessage(text, "user");
    input.value = "";
    input.style.height = "auto";

    btn.disabled = true;
    const botMsg = addMessage("...", "bot");

    const api =
        "https://corsproxy.io/?" +
        encodeURIComponent(
            "https://shython-apis.liara.run/ai?prompt=" + text
        );

    fetch(api)
        .then(r => r.text())
        .then(t => {
            try {
                const res = JSON.parse(t);
                typeText(botMsg, res.data || "Ù¾Ø§Ø³Ø®ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯");
            } catch {
                typeText(botMsg, t);
            }
        })
        .catch(() => {
            botMsg.innerText = "Ø®Ø·Ø§";
            btn.disabled = false;
        });
}

/* Enter */
input.addEventListener("keydown", e => {
    if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        send();
    }
});

/* auto resize */
input.addEventListener("input", () => {
    input.style.height = "auto";
    input.style.height = input.scrollHeight + "px";
});

/* Ø°Ø®ÛŒØ±Ù‡ */
function saveChat() {
    localStorage.setItem("chat", chat.innerHTML);
}

/* Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† */
function clearChat() {
    if (confirm("Ú†Øª Ù¾Ø§Ú© Ø´ÙˆØ¯ØŸ")) {
        chat.innerHTML = "";
        localStorage.removeItem("chat");
    }
}

/* ØªÙ… */
function toggleTheme() {
    document.body.classList.toggle("light");
    localStorage.setItem(
        "theme",
        document.body.classList.contains("light") ? "light" : "dark"
    );
}

/* Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ… */
if (localStorage.getItem("theme") === "light") {
    document.body.classList.add("light");
}
</script>

</body>
</html>
